<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>陈中瑞</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="./js/layui-v2.5.6/layui/css/layui.css">

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.2.0/jquery.js"></script>
    <script src="./js/layui-v2.5.6/layui/layui.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <script src="https://cdn.bootcdn.net/ajax/libs/babel-polyfill/7.8.0/polyfill.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.2.0/jquery.js"></script>
    <script src="https://cdn.bootcss.com/vue/2.6.10/vue.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/qs/6.9.0/qs.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/vue-resource/1.5.1/vue-resource.js"></script>


    <script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-cookie/1.4.0/jquery.cookie.js"></script>





</head>
<style type="text/css">
    .container-fluid {
        display: flex;
        flex-direction: row;
        width: 100%;
        height: 500px;
        margin-top: 10px;
    }
    
    .left {
        height: 100%;
        order: -1;
        flex: 0 0 200px;
    }
    
    .right {
        height: 100%;
        flex: 1 1;
    }
    
    .logo,
    .btn-group-vertical {
        display: table;
        margin: 0 auto;
    }
    
    .btn-left {
        border: none !important;
        background: transparent;
        font-size: 16px;
        font-weight: lighter !important;
        margin-bottom: 10px;
    }
    
    .btn-left:focus,
    .btn-left:hover {
        background-color: #5c8dff;
        color: #ffffff;
        font-size: 16px;
        font-weight: lighter !important;
        border-radius: 100px !important;
    }
    
    .glyphicon {
        margin-right: 15px;
    }
    
    .close_img {
        display: inline-table;
        width: 40px;
        height: auto;
        /* float: right; */
    }
    
    .user_img {
        display: inline-block;
        width: 50px;
        height: auto;
        margin-right: 10px;
    }
    
    .nav {
        text-align: center;
        font-size: 18px;
        line-height: 40px;
        margin-bottom: -1px !important;
        border: none;
    }
    
    .daka,
    .count {
        display: inline-block;
        width: 45%;
    }
    
    .month {
        width: 95%;
    }
    
    .pie {
        display: inline-block;
        width: 97%;
    }
    
    .calendar {
        background-color: #a1decb;
    }
    
    table {
        border-collapse: separate;
        border-width: 0px 0px 1px 1px;
        margin: 10px auto;
        font-size: 20px;
    }
    
    td,
    th {
        width: 81px;
        height: 45px;
        text-align: center;
        vertical-align: middle;
        color: #5d6b7a;
        position: relative;
        font-size: 16px;
    }
    
    .thead th {
        height: 50px;
        font-weight: bold;
        font-size: 14px;
    }
    
    td {
        position: relative;
    }
    
    .col-md-3 {
        margin-top: 50px;
    }
</style>


<body>


    <div class="container-fluid" id="app">
        <!-- 左侧边栏 -->
        <div class="left">

            <div class="logo">
                <img src="./img/uugai.com-1585724965584.png" width="150px" height="auto" class="img-responsive img-circle">
            </div>
            <div class="btn-group-vertical" role="group" aria-label="...">

                <button type="button" class="btn-left btn" @click="change()">
                    <span class="glyphicon glyphicon-home" aria-hidden="true"></span>
                    员工信息
                </button>
                <button type="button" class="btn-left btn" @click="change1()">
                    <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
                    员工出勤
                </button>
                <button type="button " class="btn-left btn ">
                    <span class="glyphicon glyphicon-edit " aria-hidden="true "></span>
                    请假处理
                </button>
            </div>

        </div>


        <div class="right">
            <div class="nav panel panel-default">考勤管理系统
                <span style="float: right;margin-right:35px ">
                    <img src="./img/63dba6d27b79483ea51f51c42c0604cd!400x400.jpeg "
                        class="img-responsive img-circle close_img ">
                    <font style="margin-left: 15px; " class="username"></font>
                </span>
            </div>






            <div id="text1">

                <form class="layui-form" name="form" action=" ">
                    <div class="layui-form-item" style="margin-left:350px;">
                        <div class="layui-inline ">
                            <input type="text" id="userName" onkeydown='KeyDown()' name="userName" required lay-verify="required" placeholder="请输入用户名" autocomplete="off" class="layui-input">
                        </div>
                        <button class="layui-btn layui-btn-normal" type="button" onclick="return false;" data-type="reload" name="search" id="selectbyCondition">搜索</button>
                        <button class="layui-btn layui-btn-normal" type="button" onclick="insert() ">添加</button>
                    </div>
                </form>

                <table class="layui-hide" id="test" lay-filter="test">

                </table>





            </div>

            <div id="text2" style="display: none; ">
                <table class="layui-hide " id="Attendance" lay-filter="Attendance ">

                </table>

            </div>




        </div>


    </div>
    <script type="text/html" id="barDemo">
        <a class="layui-btn layui-btn-xs" lay-event="edit">设为管理员</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    </script>



    <script>
        var vm = new Vue({
            el: '#app',
            data: {
                a: 'q',

                list: [],
                customers: {}

            },
            created() { //这个函数与vue的生命周期有关，data和methods初始化后，会执行该函数

                // this.getList();

            },
            methods: {
                img() {
                    $("#user").change(function() {
                        var files = $("#user").get(0).files[0]; //获取file控件中的内容
                        var reader = new FileReader();
                        reader.readAsDataURL(files);
                        reader.onload = function(f) {
                            // var result = document.getElementById("result ");
                            document.getElementById("tx_img").src = this.result;
                        }
                        var formdata = new FormData();
                        formdata.append("file", files);
                        console.log(files)
                        $.ajax({
                            type: "POST",
                            url: "/api/mgr/img", //接口请求地址
                            contentType: false,
                            processData: false,
                            data: formdata,
                            success: function(data) {}
                        });

                    });
                },

                change() {

                    $("#text1").show()
                    $("#text2").hide()


                },

                change1() {

                    $("#text2").show()
                    $("#text1").hide()

                },

            }
        })
    </script>

    <script>
        layui.use('table', function() {
            var table = layui.table;
            table.render({
                elem: '#Attendance',
                id: 'test',
                url: '/api/mgr/customers?action=Clocktime_list',
                toolbar: '#toolbarDemo', //开启头部工具栏，并为其绑定左侧模板
                defaultToolbar: ['filter', 'print', { //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可
                    title: '提示',
                    layEvent: 'LAYTABLE_EXPORT',
                    icon: 'layui-icon-export',

                }],
                page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
                    layout: ['count', 'prev', 'page', 'next', 'skip', 'limit', ], //自定义分页布局
                    //,curr: 5 //设定初始在第 5 页
                    limits: [10],


                    first: false, //不显示首页

                    last: false //不显示尾页

                },

                title: '用户数据表',
                cols: [
                    [{
                        field: 'name',
                        title: '姓名',
                        align: 'center',
                        fixed: 'left',
                        unresize: true,
                        sort: true
                    }, {
                        field: 'signin',
                        title: '上班时间',
                        fixed: 'left',
                        align: 'center',
                        sort: true,
                        templet: function(res) {
                            if (res.signin == null) {
                                return '..'
                            } else {

                                time = res.signin.slice(11, 16);

                                return time
                            }
                        }

                    }, {
                        field: 'signout',
                        title: '下班时间',
                        fixed: 'left',
                        align: 'center',
                        templet: function(res) {
                            if (res.signout == null) {
                                return '..'
                            } else {
                                time = res.signout.slice(11, 16);

                                return time
                            }
                        },
                        sort: true
                    }, {
                        field: 'worktimes',
                        title: '加班时间',
                        fixed: 'left',
                        align: 'center',
                        templet: function(res) {

                            if (res.worktimes <= 8) {
                                return '/'
                            } else {
                                time = res.worktimes - 8
                                return time
                            }


                        }

                    }, {
                        field: 'name',
                        title: '用户名',
                        fixed: 'left',
                        align: 'center',

                        // templet: function(res) {

                        //     url = res.photo.split("/ ")[2];
                        //     img = "img/ "
                        //     return '<img class="img-responsive img-circle "  src=" ' + img + ' ' + url + ' ">'
                        // }
                    }, {
                        fixed: 'right',
                        title: '操作',
                        align: 'center',

                        toolbar: '#barDemo',

                    }]
                ],



            });

        })
    </script>


    <script>
        $("#user").change(function() {
            var files = $("#user").get(0).files[0]; //获取file控件中的内容
            var reader = new FileReader();
            reader.readAsDataURL(files);
            reader.onload = function(f) {
                // var result = document.getElementById("result ");
                document.getElementById("tx_img").src = this.result;
            }
            var formdata = new FormData();
            formdata.append("file", files);




        });
    </script>

    <script>
        function insert() {

            layer.open({
                type: 1,
                title: '添加员工信息' //不显示标题栏
                    ,

                area: '600px;',
                shade: 0.8,
                id: 'LAY_layuipro' //设定一个id，防止重复弹出
                    ,
                btn: ['确认', '取消'],
                btnAlign: 'c',
                moveType: 1 //拖拽模式，0或者1
                    ,
                content: $('#form'),
                yes: function(index, layero) {
                    var files = $("#user").get(0).files[0]; //获取file控件中的内容
                    var reader = new FileReader();
                    reader.readAsDataURL(files);
                    reader.onload = function(f) {
                        // var result = document.getElementById("result ");
                        document.getElementById("tx_img").src = this.result;
                    }
                    var formdata = new FormData();
                    formdata.append("file", files);
                    path = 'D:\\QQPCmgr\\python\\' + 'firstpy\\static/mgr\\img/' + files.name


                    // $.ajax({
                    //     type: "POST ",
                    //     url: "/api/mgr/img ", //接口请求地址
                    //     contentType: false,
                    //     processData: false,
                    //     data: formdata,
                    //     success: function(data) {}
                    // });




                    name = $('#name').val()

                    params = JSON.stringify({
                            action: "add_customer",
                            name: name,
                            img: path
                        }),

                        $.ajax({
                            type: 'post',
                            url: '/api/mgr/customers?action=add_customer',
                            data: params,
                            dataType: 'json',
                            success: function(ret) {

                                document.getElementById("form").reset();

                            },
                            error: function(e) {

                            }

                        });
                    layer.close(index); //如果设定了yes回调，需进行手工关闭

                },
                end: function(index, layero) {
                    document.getElementById("form").reset();
                    document.getElementById("tx_img").src = '';
                }
            });
        }
    </script>




    <script>
        function KeyDown() {
            if (event.keyCode == 13) {
                event.returnValue = false;
                event.cancel = true;
                form.search.click();
            }
        }
    </script>
    <script>
        layui.use('table', function() {
            var table = layui.table;
            var laypage = layui.laypage;
            var ins1 = table.render({

                elem: '#test',

                url: "/api/mgr/customers?action=export", //数据接口

                method: 'get',

                title: '',

                where: {

                    mycode: "all "

                },

                cols: [
                    [

                        {
                            field: 'id',
                            title: 'ID'
                        },

                        {
                            field: 'name',
                            title: '名称'
                        },

                    ]
                ],

                done: function(res, curr, count) {

                    exportData = res.data;

                }

            });




            table.render({
                elem: '#test',
                id: 'test',
                url: '/api/mgr/customers?action=list_staff',
                toolbar: '#toolbarDemo', //开启头部工具栏，并为其绑定左侧模板
                defaultToolbar: ['filter', 'print', { //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可
                    title: '提示',
                    layEvent: 'LAYTABLE_EXPORT',
                    icon: 'layui-icon-export',

                }],
                page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
                    layout: ['count', 'prev', 'page', 'next', 'skip', 'limit', ], //自定义分页布局
                    //,curr: 5 //设定初始在第 5 页
                    limits: [10],


                    first: false, //不显示首页

                    last: false //不显示尾页

                },

                title: '用户数据表',
                cols: [
                    [{
                        field: 'id',
                        title: 'ID',
                        align: 'center',
                        fixed: 'left',
                        unresize: true,
                        sort: true
                    }, {
                        field: 'name',
                        title: '用户名',
                        fixed: 'left',
                        align: 'center',

                    }, {
                        field: 'photo',
                        title: '头像',
                        fixed: 'left',
                        align: 'center',

                        templet: function(res) {

                            url = res.photo.split("/")[2];
                            img = "img/"
                            return '<img class="img-responsive img-circle "  src="' + img + '' + url + '">'
                        }
                    }, {
                        field: 'sex',
                        title: '性别',
                        fixed: 'left',
                        align: 'center',

                        sort: true
                    }, {
                        fixed: 'right',
                        title: '操作',
                        align: 'center',

                        toolbar: '#barDemo',

                    }]
                ],



            });


            //根据条件查询表格数据重新加载
            var $ = layui.$,
                active = {
                    reload: function() {
                        //获取用户名
                        var demoReload = $('#userName');
                        console.log(demoReload.val())
                            //执行重载
                        table.reload('test', {

                            page: {
                                curr: 1 //重新从第 1 页开始
                            }
                            //根据条件查询
                            ,
                            where: {
                                name: demoReload.val()
                            }
                        });
                    }
                };



            //点击搜索按钮根据用户名称查询
            $('#selectbyCondition').on('click', function() {
                var type = $(this).data('type');
                active[type] ? active[type].call(this) : '';
            });




            //头工具栏事件
            table.on('toolbar(test)', function(obj) {
                var checkStatus = table.checkStatus(obj.config.id);
                switch (obj.event) {

                    //自定义头工具栏右侧图标 - 提示
                    case 'LAYTABLE_EXPORT':

                        table.exportFile(ins1.config.id, exportData, 'xls');
                        break;
                };
            });

            //监听行工具事件
            table.on('tool(test)', function(obj) {
                var data = obj.data;
                // 删除用户
                if (obj.event === 'del') {
                    layer.confirm('真的删除行么', function(index) {
                        obj.del();
                        params = JSON.stringify({
                                action: "del_customer ",
                                id: data.id,
                            }),
                            console.log(params)
                        $.ajax({
                            type: 'post',
                            url: '/api/mgr/customers?action=del_customer',
                            data: params,
                            dataType: 'json',
                            success: function(ret) {

                                var divshow = $(".layui-laypage-count ");
                                divshow.text(" "); // 清空数据
                                divshow.append('共 ' + ret.count + ' 条'); // 添加Html内容，不能用Text 或 Val
                            },
                            error: function(e) {

                            }

                        });
                        layer.close(index);
                    });

                } else if (obj.event === 'edit') {
                    // 设为管理员
                    layer.confirm('确定将改员工设为管理员？', function(index) {
                        params = JSON.stringify({
                                action: "vip ",
                                id: data.id,
                            }),
                            console.log(params)
                        $.ajax({
                            type: 'post',
                            url: '/api/mgr/customers?action=vip',
                            data: params,
                            dataType: 'json',
                            success: function(ret) {


                            },
                            error: function(e) {

                            }

                        });
                        layer.close(index);
                    });
                }
            });
        });
    </script>

</body>
<form class="layui-form" id="form">
    <div class="layui-form-item">
        <label class="layui-form-label">员工姓名</label>
        <div class="layui-input-block">
            <input type="text" id="name" name="name" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
            <div>
                <input type="file" name="file" id="user" />
                <img src="" id="tx_img" alt="">
            </div>
            11
        </div>
    </div>

</form>

</html>